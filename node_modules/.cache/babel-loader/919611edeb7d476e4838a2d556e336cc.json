{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/olive/Uni/Projects/ifetch-chatApplication/chat_application/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _toConsumableArray from\"C:/Users/olive/Uni/Projects/ifetch-chatApplication/chat_application/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"C:/Users/olive/Uni/Projects/ifetch-chatApplication/chat_application/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/olive/Uni/Projects/ifetch-chatApplication/chat_application/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";/*global chrome*/import logo from'./logo.svg';import'./App.css';import React,{useState,useEffect}from'react';// import {useSettingsStore} from '../common/settings'\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var DUMMY_DATA=[{provider_id:\"user\",utterance:\"Hi!\"},{provider_id:\"iFetch\",utterance:\"Hi! My name is iFetch, how can I help you?\"}];var IMAGES_ENDPOINT=\"https://large.novasearch.org/farfetch_products/images/\";var MESSAGES_ENDPOINT=\"https://ifetch.novasearch.org/agent/\";function Message(props){var message=props.message;var is_user=props.message.provider_id!=\"iFetch\";return/*#__PURE__*/_jsxs(\"div\",{className:is_user?'message-user':'message-bot',children:[/*#__PURE__*/_jsx(\"div\",{className:is_user?'message-content-user':'message-content-bot',children:message.utterance}),/*#__PURE__*/_jsx(\"div\",{className:is_user?'message-timestamp-user':'message-timestamp-bot',children:message.provider_id})]});}function Messages(props){return/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:props.messages.map(function(message,i){return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Message,{message:message})},message.provider_id+i);})});}function SendMessageForm(props){var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),message=_useState2[0],setMessage=_useState2[1];var handleChange=function handleChange(e){setMessage(e.target.value);// TODO: Fix this!!!\n// props.handleChange(value)\n};var handleSubmit=function handleSubmit(e){e.preventDefault();props.handleSubmit(message);setMessage(\"\");};return/*#__PURE__*/_jsx(\"form\",{onSubmit:handleSubmit,children:/*#__PURE__*/_jsx(\"input\",{className:\"text-form\",onChange:handleChange,value:message,placeholder:\"Type your message and hit ENTER\",type:\"text\"})});}function SendMessage(_x,_x2,_x3,_x4,_x5,_x6){return _SendMessage.apply(this,arguments);}function _SendMessage(){_SendMessage=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(utterance,userId,sessionId,userAction,selectedId,respondeCallback){var isUpToDate,response,_args=arguments;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:isUpToDate=_args.length>6&&_args[6]!==undefined?_args[6]:false;_context.next=3;return fetch(MESSAGES_ENDPOINT,{method:\"POST\",body:JSON.stringify({utterance:utterance,user_id:userId,// TODO: Randomize\nsession_id:sessionId,// TODO: Randomize\nuser_action:userAction,interface_selected_product_id:selectedId}),headers:{\"Content-type\":\"application/json\"}}).then(function(response){return response.json();}).then(function(data){console.log(data);respondeCallback(data,utterance,isUpToDate);}).catch(function(err){console.log(err.message);});case 3:response=_context.sent;return _context.abrupt(\"return\",response);case 5:case\"end\":return _context.stop();}}},_callee);}));return _SendMessage.apply(this,arguments);}function randomNumberInRange(min,max){// üëáÔ∏è get number between min (inclusive) and max (inclusive)\nreturn Math.floor(Math.random()*(max-min+1))+min;}function App(){var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),messages=_useState4[0],setMessages=_useState4[1];var _useState5=useState(\"\".concat(randomNumberInRange(0,10000))),_useState6=_slicedToArray(_useState5,2),userID=_useState6[0],setUserID=_useState6[1];var _useState7=useState(\"\".concat(randomNumberInRange(0,10000))),_useState8=_slicedToArray(_useState7,2),sessionID=_useState8[0],setSessionID=_useState8[1];var sendTestMessage=function sendTestMessage(){var message={// from: Sender.React,\nmessage:\"Hello from React\",uID:userID,sID:sessionID};var queryInfo={active:true,currentWindow:true};chrome.tabs&&chrome.tabs.query(queryInfo,function(tabs){var currentTabId=tabs[0].id;chrome.tabs.sendMessage(currentTabId,message,function(response){// setResponseFromContent(response);\nconsole.log(\"response\");});});};var handleSubmit=function handleSubmit(message){// if (!hasResponded) return\n// console.log(settings)\nvar temp={provider_id:\"user\",utterance:message};setMessages([].concat(_toConsumableArray(messages),[temp]));SendMessage(message,userID,sessionID,\"\",\"\",recieveMessage);};var recieveMessage=function recieveMessage(message,utterance){var isUpToDate=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;// if (!message.has_response) return\nvar temp1={provider_id:\"iFetch\",utterance:message.response};if(isUpToDate){setMessages([].concat(_toConsumableArray(messages),[temp1]));return;}var temp2={provider_id:\"user\",utterance:utterance};setMessages([].concat(_toConsumableArray(messages),[temp2,temp1]));// console.log(messages)\n};useEffect(function(){var response=SendMessage(\"Hi!\",userID,sessionID,\"\",\"\",recieveMessage,true);sendTestMessage();},[]);// console.log(value)\nreturn/*#__PURE__*/_jsxs(\"div\",{className:\"chat-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"title-container\",children:/*#__PURE__*/_jsx(\"h1\",{className:\"message-content-bot\",children:\"iFetch\"})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Messages,{messages:messages})}),/*#__PURE__*/_jsx(\"div\",{className:\"form-container\",children:/*#__PURE__*/_jsx(SendMessageForm,{handleSubmit:handleSubmit})})]});}export default App;","map":{"version":3,"names":["logo","React","useState","useEffect","DUMMY_DATA","provider_id","utterance","IMAGES_ENDPOINT","MESSAGES_ENDPOINT","Message","props","message","is_user","Messages","messages","map","i","SendMessageForm","setMessage","handleChange","e","target","value","handleSubmit","preventDefault","SendMessage","userId","sessionId","userAction","selectedId","respondeCallback","isUpToDate","fetch","method","body","JSON","stringify","user_id","session_id","user_action","interface_selected_product_id","headers","then","response","json","data","console","log","catch","err","randomNumberInRange","min","max","Math","floor","random","App","setMessages","userID","setUserID","sessionID","setSessionID","sendTestMessage","uID","sID","queryInfo","active","currentWindow","chrome","tabs","query","currentTabId","id","sendMessage","temp","recieveMessage","temp1","temp2"],"sources":["C:/Users/olive/Uni/Projects/ifetch-chatApplication/chat_application/src/App.js"],"sourcesContent":["/*global chrome*/\nimport logo from './logo.svg'\nimport './App.css'\nimport React, { useState, useEffect } from 'react'\n// import {useSettingsStore} from '../common/settings'\n\n\nconst DUMMY_DATA = [\n  {\n    provider_id : \"user\",\n    utterance : \"Hi!\"\n  },\n  {\n    provider_id : \"iFetch\",\n    utterance : \"Hi! My name is iFetch, how can I help you?\"\n  }\n]\n\nconst IMAGES_ENDPOINT = \"https://large.novasearch.org/farfetch_products/images/\"\nconst MESSAGES_ENDPOINT = \"https://ifetch.novasearch.org/agent/\"\n\nfunction Message(props) {\n  var message = props.message\n  var is_user = props.message.provider_id != \"iFetch\"\n\n  return (\n    <div className={is_user ? 'message-user' : 'message-bot'}>\n      <div className={is_user ? 'message-content-user' : 'message-content-bot'}>\n        {message.utterance}\n      </div>\n      <div className={is_user ? 'message-timestamp-user' : 'message-timestamp-bot'}>\n        {message.provider_id}\n      </div>\n    </div>\n  )\n}\n\nfunction Messages(props) {\n  return (\n    <div className=\"container\">                 \n      {props.messages.map((message, i) => {\n        return (\n          <div key={message.provider_id + i}>\n            <Message message={message}/>\n          </div>\n        )\n      })}\n    </div>\n  )\n}\n\nfunction SendMessageForm (props) {\n  const [message, setMessage] = useState(\"\")\n  \n  var handleChange = (e) => {\n    setMessage(e.target.value) // TODO: Fix this!!!\n    // props.handleChange(value)\n  }\n\n  const handleSubmit = (e) => {\n    e.preventDefault();\n    props.handleSubmit(message)\n    setMessage(\"\")\n  }\n\n  return (\n    <form\n      onSubmit={handleSubmit}>\n      <input\n        className='text-form'\n        onChange={handleChange}\n        value={message}\n        placeholder=\"Type your message and hit ENTER\"\n        type=\"text\"/>\n    </form>\n  )\n}\n\nasync function SendMessage (\n  utterance, userId, sessionId,\n  userAction, selectedId, \n  respondeCallback, isUpToDate=false) {\n\n  const response = await fetch(MESSAGES_ENDPOINT, {\n    method: \"POST\",\n    body: JSON.stringify({\n      utterance : utterance,\n      user_id : userId, // TODO: Randomize\n      session_id: sessionId, // TODO: Randomize\n      user_action: userAction,\n      interface_selected_product_id: selectedId \n    }),\n    headers: {\n      \"Content-type\": \"application/json\"\n    },\n    }).then((response) => response.json())\n    .then((data) => {\n      console.log(data)\n      respondeCallback(data, utterance, isUpToDate)\n    })\n    .catch((err) => {\n      console.log(err.message)\n    })\n\n    return response\n}\n\nfunction randomNumberInRange(min, max) {\n  // üëáÔ∏è get number between min (inclusive) and max (inclusive)\n  return Math.floor(Math.random() * (max - min + 1)) + min;\n}\n\nfunction App() {\n  const [messages, setMessages] = useState([])\n  const [userID, setUserID] = useState(`${randomNumberInRange(0, 10000)}`)\n  const [sessionID, setSessionID] = useState(`${randomNumberInRange(0, 10000)}`)\n\n  const sendTestMessage = () => {\n    const message = {\n        // from: Sender.React,\n        message: \"Hello from React\",\n        uID: userID,\n        sID: sessionID\n    }\n\n    const queryInfo = {\n        active: true,\n        currentWindow: true\n    };\n\n    chrome.tabs && chrome.tabs.query(queryInfo, tabs => {\n        const currentTabId = tabs[0].id;\n        chrome.tabs.sendMessage(\n            currentTabId,\n            message,\n            (response) => {\n                // setResponseFromContent(response);\n                console.log(\"response\")\n            });\n      });\n  };\n\n  const handleSubmit = (message) => {\n    // if (!hasResponded) return\n    // console.log(settings)\n    const temp = {\n      provider_id : \"user\",\n      utterance : message\n    }\n\n    setMessages([...messages, temp])\n    SendMessage(message, userID, sessionID, \"\", \"\", recieveMessage)\n  }\n\n  const recieveMessage = (message, utterance, isUpToDate=false) => {\n    // if (!message.has_response) return\n    \n    const temp1 = {\n      provider_id : \"iFetch\",\n      utterance : message.response\n    }\n\n    if (isUpToDate) {\n      setMessages([...messages, temp1])\n      return\n    }\n\n    const temp2 = {\n      provider_id : \"user\",\n      utterance : utterance\n    }\n\n    setMessages([...messages, temp2, temp1])\n    // console.log(messages)\n  }\n\n  useEffect(() => {\n    const response = SendMessage(\"Hi!\", userID, sessionID, \"\", \"\", recieveMessage, true)\n    sendTestMessage()\n  }, [])\n  \n  // console.log(value)\n\n  return (\n    <div className='chat-container'>\n      <div className='title-container'>\n        <h1 className='message-content-bot'>iFetch</h1>\n      </div>\n      <div>\n        <Messages messages={messages}></Messages>\n      </div>\n      <div className='form-container'>\n        <SendMessageForm handleSubmit = {handleSubmit}/>\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}